<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>International Cricket - Live & Recent Matches</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<header>
    <h1>üèè International Cricket - Men's & Women's Matches</h1>
    <p id="last-updated">Loading...</p>
</header>

<main>
    <div id="matches-container" class="matches-container">
        <p>Loading matches...</p>
    </div>
</main>

<script>
async function loadMatches() {
    const container = document.getElementById("matches-container");
    const lastUpdated = document.getElementById("last-updated");
    container.innerHTML = "<p>Loading matches...</p>";

    try {
        const response = await fetch("/api/todays-matches");
        if (!response.ok) {
            throw new Error("Network response was not ok");
        }
        const matches = await response.json();

        if (!matches.length) {
            container.innerHTML = "<p>No international matches available at the moment.</p>";
            return;
        }

        container.innerHTML = "";
        matches.forEach(match => {
            const card = document.createElement("div");
            card.className = "match-card";
            
            // Build series info section
            let seriesHtml = '';
            if (match.series_name !== '-') {
                seriesHtml = `<p class="series-info"><strong>üìã Series:</strong> ${match.series_name}`;
                if (match.match_number !== '-') {
                    seriesHtml += ` (Match ${match.match_number})`;
                }
                seriesHtml += '</p>';
            }
            
            // Build toss info section
            let tossHtml = '';
            if (match.toss_winner !== '-') {
                tossHtml = `<p class="toss-info"><strong>ü™ô Toss:</strong> ${match.toss_winner}`;
                if (match.toss_decision !== '-') {
                    tossHtml += ` - ${match.toss_decision}`;
                }
                tossHtml += '</p>';
            }
            
            // Build officials section
            let officialsHtml = '';
            if (match.umpires !== '-' || match.match_referee !== '-') {
                officialsHtml = '<div class="officials-section">';
                if (match.umpires !== '-') {
                    officialsHtml += `<p><strong>üë®‚Äç‚öñÔ∏è Umpires:</strong> ${match.umpires}</p>`;
                }
                if (match.match_referee !== '-') {
                    officialsHtml += `<p><strong>üéØ Match Referee:</strong> ${match.match_referee}</p>`;
                }
                officialsHtml += '</div>';
            }
            
            // Build awards section if any awards are available
            let awardsHtml = '';
            const hasAwards = match.man_of_match !== '-' || match.man_of_series !== '-' || 
                            match.best_batsman !== '-' || match.best_bowler !== '-';
            
            if (hasAwards) {
                awardsHtml = '<div class="awards-section"><h3>üèÜ Awards & Top Performers</h3>';
                if (match.man_of_match !== '-') {
                    awardsHtml += `<p><strong>üèÜ Man of the Match:</strong> ${match.man_of_match}</p>`;
                }
                if (match.man_of_series !== '-') {
                    awardsHtml += `<p><strong>üèÖ Man of the Series:</strong> ${match.man_of_series}</p>`;
                }
                if (match.best_batsman !== '-') {
                    awardsHtml += `<p><strong>üèè Best Batsman:</strong> ${match.best_batsman}</p>`;
                }
                if (match.best_bowler !== '-') {
                    awardsHtml += `<p><strong>‚ö° Best Bowler:</strong> ${match.best_bowler}</p>`;
                }
                awardsHtml += '</div>';
            }
            
            // Build detailed scorecard section (expandable)
            let detailedScorecardHtml = '';
            if (match.detailed_score && match.detailed_score.innings && match.detailed_score.innings.length > 0) {
                detailedScorecardHtml = '<div class="detailed-scorecard">';
                detailedScorecardHtml += '<button class="btn-expand-scorecard" onclick="this.nextElementSibling.classList.toggle(\'hidden\')">üìã Show Full Scorecard with Player Stats</button>';
                detailedScorecardHtml += '<div class="scorecard-details hidden">';
                
                match.detailed_score.innings.forEach((innings, idx) => {
                    detailedScorecardHtml += `<div class="innings-section">`;
                    detailedScorecardHtml += `<h4>${innings.inning || 'Innings ' + (idx + 1)}</h4>`;
                    detailedScorecardHtml += `<p class="innings-score"><strong>Total Score:</strong> ${innings.r}/${innings.w} (${innings.o} overs)</p>`;
                    
                    // Add batting stats if available
                    if (innings.batting && innings.batting.length > 0) {
                        detailedScorecardHtml += '<div class="batting-stats">';
                        detailedScorecardHtml += '<h5>üèè Batting</h5>';
                        detailedScorecardHtml += '<table class="player-stats-table">';
                        detailedScorecardHtml += '<thead><tr><th>Player</th><th>Runs</th><th>Balls</th><th>4s</th><th>6s</th><th>SR</th></tr></thead>';
                        detailedScorecardHtml += '<tbody>';
                        innings.batting.forEach(player => {
                            const sr = player.b > 0 ? ((player.r / player.b) * 100).toFixed(1) : '0.0';
                            detailedScorecardHtml += `<tr>
                                <td>${player.name || 'Unknown'}</td>
                                <td><strong>${player.r || 0}</strong></td>
                                <td>${player.b || 0}</td>
                                <td>${player['4s'] || 0}</td>
                                <td>${player['6s'] || 0}</td>
                                <td>${sr}</td>
                            </tr>`;
                        });
                        detailedScorecardHtml += '</tbody></table></div>';
                    }
                    
                    // Add bowling stats if available
                    if (innings.bowling && innings.bowling.length > 0) {
                        detailedScorecardHtml += '<div class="bowling-stats">';
                        detailedScorecardHtml += '<h5>‚ö° Bowling</h5>';
                        detailedScorecardHtml += '<table class="player-stats-table">';
                        detailedScorecardHtml += '<thead><tr><th>Player</th><th>Overs</th><th>Maidens</th><th>Runs</th><th>Wickets</th><th>Econ</th></tr></thead>';
                        detailedScorecardHtml += '<tbody>';
                        innings.bowling.forEach(player => {
                            const econ = player.o > 0 ? (player.r / player.o).toFixed(2) : '0.00';
                            detailedScorecardHtml += `<tr>
                                <td>${player.name || 'Unknown'}</td>
                                <td>${player.o || 0}</td>
                                <td>${player.m || 0}</td>
                                <td>${player.r || 0}</td>
                                <td><strong>${player.w || 0}</strong></td>
                                <td>${econ}</td>
                            </tr>`;
                        });
                        detailedScorecardHtml += '</tbody></table></div>';
                    }
                    
                    detailedScorecardHtml += `</div>`;
                });
                
                detailedScorecardHtml += '</div></div>';
            }
            
            card.innerHTML = `
                <h2>${match.team1} vs ${match.team2}</h2>
                ${seriesHtml}
                <p><strong>Format:</strong> ${match.match_format}</p>
                <p><strong>Start:</strong> ${match.start_time}</p>
                <p><strong>Venue:</strong> ${match.venue}</p>
                <p><strong>Status:</strong> ${match.status}</p>
                <p><strong>Score:</strong> ${match.score_summary}</p>
                ${tossHtml}
                ${detailedScorecardHtml}
                ${officialsHtml}
                ${awardsHtml}
            `;
            container.appendChild(card);
        });

        const now = new Date();
        lastUpdated.textContent = "Last updated: " + now.toLocaleTimeString();
    } catch (err) {
        container.innerHTML = "<p>Error loading matches.</p>";
        console.error(err);
    }
}

// Initial load
loadMatches();

// Optional: refresh every 2 minutes (120000 ms)
setInterval(loadMatches, 120000);
</script>
</body>
</html>
